# Complete Task Schedule Template
# This file shows ALL available parameters with their descriptions

schedule:
  # Schedule metadata (optional)
  name: "Schedule Name"
  description: "Detailed description of what this schedule does"
  
  # Default values applied to all tasks (optional)
  # Individual tasks can override these
  defaults:
    deadline_us: 1000000            # Default deadline (1 second)
    rt_policy: "none"               # RT scheduling: "none", "fifo", "rr", "deadline"
    rt_priority: 50                 # RT priority (1-99, 99 = highest)
    cpu_affinity: -1                # CPU core (-1 = no affinity)
    
  # Task definitions (required)
  tasks:
    # ========================================
    # SEQUENTIAL TASK TEMPLATE
    # ========================================
    - id: sequential_task_example           # REQUIRED: Unique task identifier
      address: "task1:50051"                # REQUIRED: gRPC address
      mode: sequential                      # REQUIRED: Execution mode
      
      # Timing (optional for sequential)
      scheduled_time_us: 0                  # Start time (usually 0 for sequential)
      deadline_us: 3000000                  # Task deadline in microseconds
      estimated_duration_us: 500000         # Estimated duration
      
      # Criticality
      
      # Real-time configuration (optional)
      rt_policy: "fifo"                     # RT policy: "none", "fifo", "rr", "deadline"
      rt_priority: 80                       # RT priority (1-99, 99 = highest)
      cpu_affinity: 0                       # CPU core to bind to (-1 = no affinity)
      
      # Dependencies
      depends_on: previous_task_id          # Wait for this task to complete (optional)
                                            # Omit or leave empty for no dependency
      
      # Custom parameters (optional)
      parameters:
        key1: "value1"
        key2: "value2"
        mode: "fast"
        iterations: "100"
        # task_id is automatically added by parser
    
    # ========================================
    # TIMED TASK TEMPLATE
    # ========================================
    - id: timed_task_example
      address: "task2:50051"
      mode: timed                           # REQUIRED: Timed execution mode
      
      # Timing (required for timed)
      scheduled_time_us: 5000000            # REQUIRED: Execute at 5 seconds from start
      deadline_us: 6000000                  # Deadline (6 seconds)
      estimated_duration_us: 800000         # Estimated duration (800ms)
      
      # Criticality
      
      # Real-time configuration (optional)
      rt_policy: "rr"                       # RT policy: "none", "fifo", "rr", "deadline"
      rt_priority: 60                       # RT priority (1-99, 99 = highest)
      cpu_affinity: 1                       # CPU core to bind to (-1 = no affinity)
      
      # Dependencies (not used for timed tasks)
      # depends_on: ""                      # Leave empty or omit
      
      # Custom parameters
      parameters:
        sensor_id: "temp_01"
        sample_rate: "1000"
        filter: "lowpass"

# ========================================
# FIELD REFERENCE
# ========================================
#
# REQUIRED FIELDS (all tasks):
#   - id: string                  Unique task identifier
#   - address: string             gRPC address (e.g., "task1:50051")
#   - mode: string                "sequential" or "timed"
#
# MODE-SPECIFIC REQUIRED:
#   Sequential mode:
#     - (none additional)
#   Timed mode:
#     - scheduled_time_us: int64  Execution time in microseconds
#
# OPTIONAL FIELDS:
#   - scheduled_time_us: int64    Start time (default: 0 for sequential)
#   - deadline_us: int64          Task deadline (default: from defaults or 1000000)
#   - estimated_duration_us: int64 Estimated duration (default: 1000000)
#   - depends_on: string          Task ID to wait for (sequential only)
#   - parameters: map             Key-value parameters passed to task
#   - rt_policy: string           RT policy: "none", "fifo", "rr", "deadline" (default: "none")
#   - rt_priority: int            RT priority 1-99, 99=highest (default: 50)
#   - cpu_affinity: int           CPU core to bind to, -1=no affinity (default: -1)
#
# TIME UNITS:
#   All times are in microseconds (µs):
#     1 ms      = 1,000 µs
#     100 ms    = 100,000 µs
#     1 second  = 1,000,000 µs
#     5 seconds = 5,000,000 µs
#     1 minute  = 60,000,000 µs
#
# ADDRESS MAPPING:
#   Docker mode (DOCKER_CONTAINER=true):
#     - Use Docker hostnames: "task1:50051", "task2:50052", "task3:50053"
#   Native mode (DOCKER_CONTAINER not set):
#     - Use localhost: "localhost:50051", "localhost:50052", "localhost:50053"
#
# EXECUTION MODES:
#   sequential:
#     - Tasks execute in order
#     - Can wait for dependencies via depends_on
#     - scheduled_time_us is usually 0 (ignored if depends_on is set)
#   
#   timed:
#     - Tasks execute at scheduled_time_us
#     - Run concurrently with other tasks
#     - depends_on is ignored
#
# REAL-TIME CONFIGURATION:
#   rt_policy options:
#     - "none": No real-time scheduling (default)
#     - "fifo": SCHED_FIFO - First In First Out, strict priority
#     - "rr": SCHED_RR - Round Robin with time slicing
#     - "deadline": SCHED_DEADLINE - Deadline-based scheduling
#   
#   rt_priority: 1-99 (99 = highest priority)
#     - Only used with "fifo" and "rr" policies
#     - Higher priority tasks preempt lower priority tasks
#   
#   cpu_affinity: CPU core number or -1
#     - Binds task to specific CPU core
#     - -1 = no affinity (kernel decides)
#     - Use same core for multiple tasks to test priority preemption
#   
#   NOTE: Real-time scheduling requires CAP_SYS_NICE capability
#         Run with: docker run --cap-add=SYS_NICE ...
#
# DEFAULTS:
#   - Values in defaults section apply to all tasks
#   - Individual task values override defaults
#   - If neither is specified, built-in defaults are used:
#       deadline_us: 1000000
#       estimated_duration_us: 1000000
#       rt_policy: "none"
#       rt_priority: 50
#       cpu_affinity: -1
#
# PARAMETERS:
#   - Arbitrary key-value pairs
#   - All values are strings (convert in task code)
#   - task_id is automatically added by parser
#   - Passed to task via gRPC
#
# VALIDATION:
#   - Parser validates required fields
#   - Missing optional fields use defaults
#   - Invalid YAML syntax falls back to test schedule
#   - Errors are logged with details
#
# EXAMPLES:
#   See:
#     - schedules/example_hybrid.yaml
#     - schedules/example_sequential.yaml
#     - schedules/example_timed.yaml
#     - schedules/example_rt_priority_test.yaml  (RT priority testing)
#
# DOCUMENTATION:
#   See DSL_GUIDE.md for complete reference
